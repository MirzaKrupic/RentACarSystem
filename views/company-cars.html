<div id="page-wrapper">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12">
                <h1 class="page-header">Your cars</h1>
            </div>
            <!-- /.col-lg-12 -->
        </div>

        <div class="row">
          <button type="button" class="btn btn-success pull-right" data-toggle="modal" data-target="#add-car-modal">
              + Add
          </button>
        </div>
        </br>
        <!-- /.row -->
        <div class="row">
            <div class="col-lg-12">
              <div class="table-responsive">
                  <table id="cars-table" class="table table-striped table-bordered table-hover" id="dataTables-example">
                      <thead>
                          <tr>
                              <th>ID</th>
                              <th>Model</th>
                              <th>Brand</th>
                              <th>Date of creation</th>
                              <th>Number of doors</th>
                              <th>Number of gears</th>
                              <th>Number of seats</th>
                              <th>Licence plate</th>
                              <th>Status</th>
                          </tr>
                      </thead>
                      <tbody>
                      </tbody>
                  </table>
              </div>
              <!-- /.table-responsive -->
            </div>
            <!-- /.col-lg-12 -->
        </div>
    </div>
    <!-- /.container-fluid -->
</div>
<!-- /#page-wrapper -->

<!-- Modal -->
<div class="modal fade" id="add-car-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
          <form id="add-car" role="form">
            <input type="hidden" name="id" />
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel">Add car</h4>
            </div>
            <div class="modal-body">

                  <div class="form-group">
                      <label>Model:</label>
                      <input type="text" name="model" class="form-control" placeholder="model of your car" required>
                  </div>
                  <div class="form-group">
                      <label>Brand</label>
                      <select id="brandsdropdown" >
                      </select>
                  </div>
                  <div class="form-group">
                      <label>Number of seats</label>
                      <input type="text" name="number_of_seats" class="form-control" placeholder="Enter text" required>
                  </div>
                  <div class="form-group">
                      <label>Number of gears</label>
                      <input type="text" name="number_of_gears" class="form-control" placeholder="Enter text" required>
                  </div>
                  <div class="form-group">
                      <label>Number of doors</label>
                      <input type="text" name="number_of_doors" class="form-control" placeholder="Enter text" required>
                  </div>
                  <div class="form-group">
                      <label>Licence plate</label>
                      <input type="text" name="licence_plate" class="form-control" placeholder="Enter text" required>
                  </div>
                  <div class="form-group">
                      <label>Car Image</label>
                      <input  name="file" type="file" onchange="file2base64(this)">
                  </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="submit" class="btn btn-primary">Save changes</button>
            </div>
            </form>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<script type="text/javascript">
  getBrands();

  function getBrands(){
    RestClient.get("api/brands/all", function(data){
      for(var i = 0; i < data.length; i++){
        var option = document.createElement("option");
        option.value = data[i].id;
        option.text = data[i].name;
        document.getElementById('brandsdropdown').appendChild(option);
      }
    });
  }

  function file2base64(event){
     var user_info = AUtils.parse_jwt(window.localStorage.getItem("token"));
     var imgurl = null;
     console.log(event.files);
     var f = event.files[0];

     var reader = new FileReader();
     // Closure to capture the file information.
     reader.onload = (function(theFile) {
         return function(e) {
             // Render thumbnail.
             //$('#upload-img').attr('src',e.target.result);
             var upload = {
               name: f.name,
               content: e.target.result.split(',')[1]
             };
             $.ajax({
                  url: "api/companies/cdn",
                  type: "POST",
                  data: JSON.stringify(upload),
                  contentType: "application/json",
                  beforeSend: function(xhr){xhr.setRequestHeader('Authentication', localStorage.getItem("token"));},
                  success: function(data) {
                    console.log(data);
                    imgurl = data.url;
                    var user = '{"image":"'+imgurl+'"}';

                    var parsedJSON = JSON.parse(user);
                    console.log($("#add-car *[name='id']").val());
                    RestClient.put("api/companies/cars/"+$("#add-car *[name='id']").val(), parsedJSON, function(data){
                    });
                  },
                  error: function(jqXHR, textStatus, errorThrown ){
                    toastr.error(jqXHR.responseJSON.message);
                    console.log(jqXHR);
                  }
               });
         };
     })(f);
     // Read in the image file as a data URL.
     reader.readAsDataURL(f);
   }

</script>
